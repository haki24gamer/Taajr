{% extends "layout.html" %}

{% block title %}Paiement - Taajr{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4 text-center">Paiement</h1>
    <p class="text-right">Montant total: <strong>{{ total_amount }} €</strong></p>
    <form action="{{ url_for('confirmer_paiement') }}" method="POST" class="needs-validation" novalidate>
        <div class="form-group">
            <label for="methode_pay">Méthode de paiement:</label>
            <select name="methode_pay" id="methode_pay" class="form-control" required>
                <option value="" disabled selected>-- Choisissez une méthode --</option>
                <option value="Carte de crédit">Carte de crédit</option>
                <option value="PayPal">PayPal</option>
                <option value="Virement bancaire">Virement bancaire</option>
            </select>
            <div class="invalid-feedback">
                Veuillez sélectionner une méthode de paiement.
            </div>
        </div>

        <!-- Carte de Crédit Fields -->
        <div id="credit-card-info" class="payment-method" style="display: none;">
            <h5 class="mt-4">Informations Carte de Crédit</h5>
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="card_number">Numéro de carte:</label>
                    <input type="text" id="card_number" name="card_number" class="form-control" maxlength="16" placeholder="1234 5678 9012 3456" pattern="\d{16}" required>
                    <div class="invalid-feedback">
                        Veuillez entrer un numéro de carte valide.
                    </div>
                </div>
                <div class="form-group col-md-3">
                    <label for="expiry_date">Date d'expiration:</label>
                    <input type="month" id="expiry_date" name="expiry_date" class="form-control" required>
                    <div class="invalid-feedback">
                        Veuillez entrer une date d'expiration.
                    </div>
                </div>
                <div class="form-group col-md-3">
                    <label for="cvv">CVV:</label>
                    <input type="text" id="cvv" name="cvv" class="form-control" maxlength="3" pattern="\d{3}" placeholder="123" required>
                    <div class="invalid-feedback">
                        Veuillez entrer un CVV valide.
                    </div>
                </div>
            </div>
        </div>

        <!-- PayPal Fields -->
        <div id="paypal-info" class="payment-method" style="display: none;">
            <h5 class="mt-4">Informations PayPal</h5>
            <div class="form-group">
                <label for="paypal_email">Adresse Email PayPal:</label>
                <input type="email" id="paypal_email" name="paypal_email" class="form-control" placeholder="email@exemple.com" required>
                <div class="invalid-feedback">
                    Veuillez entrer une adresse email valide.
                </div>
            </div>
            <div class="form-group">
                <label for="paypal_password">Mot de passe PayPal:</label>
                <input type="password" id="paypal_password" name="paypal_password" class="form-control" required>
                <div class="invalid-feedback">
                    Veuillez entrer votre mot de passe PayPal.
                </div>
            </div>
        </div>

        <!-- Virement Bancaire Fields -->
        <div id="bank-transfer-info" class="payment-method" style="display: none;">
            <h5 class="mt-4">Informations Virement Bancaire</h5>
            <div class="form-group">
                <label for="account_number">Numéro de compte:</label>
                <input type="text" id="account_number" name="account_number" class="form-control" maxlength="20" required>
                <div class="invalid-feedback">
                    Veuillez entrer un numéro de compte valide.
                </div>
            </div>
            <div class="form-group">
                <label for="bank_name">Nom de la banque:</label>
                <input type="text" id="bank_name" name="bank_name" class="form-control" required>
                <div class="invalid-feedback">
                    Veuillez entrer le nom de la banque.
                </div>
            </div>
            <div class="form-group">
                <label for="routing_number">Numéro d'acheminement:</label>
                <input type="text" id="routing_number" name="routing_number" class="form-control" maxlength="9" pattern="\d{9}" required>
                <div class="invalid-feedback">
                    Veuillez entrer un numéro d'acheminement valide.
                </div>
            </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block mt-4">Confirmer le paiement</button>
    </form>
</div>

<script>
    function togglePaymentFields() {
        var method = document.getElementById('methode_pay').value;
        var creditCard = document.getElementById('credit-card-info');
        var paypal = document.getElementById('paypal-info');
        var bankTransfer = document.getElementById('bank-transfer-info');

        // Hide all payment sections
        creditCard.style.display = 'none';
        paypal.style.display = 'none';
        bankTransfer.style.display = 'none';

        // Show the selected payment section
        if (method === 'Carte de crédit') {
            creditCard.style.display = 'block';
        } else if (method === 'PayPal') {
            paypal.style.display = 'block';
        } else if (method === 'Virement bancaire') {
            bankTransfer.style.display = 'block';
        }
    }

    document.getElementById('methode_pay').addEventListener('change', togglePaymentFields);

    // Bootstrap form validation
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>
{% endblock %}